<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>购物车</title>
    <link rel="shortcut icon" type="image/x-icon" href="http://b0.hucdn.com/img/favicon.ico" media="screen">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/HeaderF.css">
    <link rel="stylesheet" href="../iconfont/iconfont.css">
    <link rel="stylesheet" href="../css/shoppingcar.css">
    <style>
        #tb {
            width: 1160px;
            border: 1px solid #cbcbcb;
            border-collapse: collapse;
            table-layout: fixed;
            background: #f3f3f3;
            color: #555;
            text-align: left;
            font-size: 12px;
            margin: 20px;
        }

        #tb thead {
            margin-bottom: 15px;
        }

        td,
        th {
            border: 1px solid #cbcbcb;
            padding: 6px 12px;
            text-align: center;
        }

        #box {
            background: #f3f3f3;
            padding: 0 0 0 25px;
            position: relative;
            margin-top: 15px;
            *zoom: 1;
            border: 1px solid #eee;
            margin-left: 20px;
        }

        .pay {
            width: 120px;
            background: #aaa;
            color: #666;
            font-size: 14px;
            background: #FF5482;
            border-radius: 5px;
            color: #fff;
            height: 40px;
            line-height: 40px;
            text-align: center;
            float: right;
        }
        .countNum{
            display: inline-block;
            width: 30px;
            height: 20px;
            font-size: 15px;
            background: white;
            border: 1px solid black;
            text-align: center;
        }
        .reduce,.add{
            font-size: 15px;
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #cbcbcb;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
        }
        .subTotal{
            color: #FF5482;
        }
        .total_text{
            color: #FF5482;
        }
    </style>
</head>

<body>
    <!-- 顶部警告 -->
    <div class="beibei-warn">
        <div>任何情况下，贝贝不会以任何理由主动联系用户索要密码、验证码或银行卡号，或是要求点击任何网址链接扫描二维码进行退款或支付操作。请提高警惕，谨防受骗！</div>
    </div>
    <!-- 顶部导航 -->
    <div class="top-nav">
        <div>
            <ul>
                <li>
                    <a href="./personal.html">bb15***4556</a>&nbsp;
                    <a class="register" href="../index.html">[退出]</a>
                </li>
                <li class="rsg"><span>|</span></li>
                <li><a href="./business.html">消息</a></li>
                <li class="rsg"><span>|</span></li>
                <li><a href="./my-order.html">我的订单</a></li>
                <li class="rsg"><span>|</span></li>
                <li><a href="./business.html">我的贝贝</a></li>
                <li class="rsg"><span>|</span></li>
                <li><a href="./business.html">商家入驻</a></li>
                <li class="rsg"><span>|</span></li>
                <li class="business"><a href="./business.html">贝贝商家中心</a>
                    <ul>
                        <li class="business-t"><a href="./business.html">贝贝商家中心</a></li>
                        <li><a href="./business.html">贝店商家中心</a></li>
                        <li><a href="./business.html">友团商家中心</a></li>
                        <li><a href="./business.html">贝仓商家中心</a></li>
                        <li><a href="./business.html">供应商中心</a></li>
                    </ul>
                </li>
                <li class="rsg"><span>|</span></li>
                <li class="service"><a href="./callservice.html">帮助中心</a>
                    <ul>
                        <li class="service-f"><a href="./callservice.html">帮助中心</a></li>
                        <li class="service-s"><a href="./callservice.html">联系客服</a></li>
                    </ul>
                </li>
                <li class="rsg"><span>|</span></li>
                <li class="follow">关注
                    <div><img src="../images/2019-09-29_155744.png" alt=""></div>
                </li>
                <li><a href="#">廉政举报</a></li>
            </ul>
        </div>
    </div>
    <!-- logo栏 -->
    <div class="logo">
        <div>
            <div class="logo-left">
                <h1><a href="./index.html.html"><img src="../images/113f25eac3906f0d_114x60.jpg" alt=""></a></h1>
            </div>
            <div class="logo-right">
                <div class="right-left"><a href="./ensure.html"><img src="../images/图层 4.png" alt=""></a>
                </div>
                <div class="shoppingA">
                    <a href="./shoppingcar.html">
                        <div class="right-circular">
                            <div class="right-circular-a"><img src="../images/图层 5.png" alt=""></div>
                        </div>
                        <div class="right-shopping">
                            我的购物车
                        </div>
                    </a>
                    <div class="right-div">
                        <div class="right-div-a">赶快去挑选商品吧！</div>
                        <div class="right-div-b">
                            <div>小计 <span>￥0.00</span></div>
                            <div><a href="./shoppingcar.html">去购物车结算</a></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 内容导航栏 -->
    <div class="main-center">
        <div class="main-wrap">
            <div class="main-title">
                <h1>我的购物车</h1>
                <i>&nbsp;</i>
            </div>
            <table id="tb">
                <thead>
                    <tr>
                            <th>商品</th>
                        <th>
                            <input type="checkbox" checked class="allCheck">
                            全选
                        </th>
                        
                        <th>商品名字</th>
                        <th>价格</th>
                        <th>数量</th>
                        <th>小计</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
            <div id="box" style="height:40px;width:936px;margin-top:10px;">
                <input type="checkbox" checked class="allCheck">
                总计：<b class="total_text"></b>
                <a href="javascript:;" class="pay">确认订单</a>
            </div>
        </div>

    </div>
    </div>



    <!-- 底部 -->
    <footer>
        <div class="footer-nav">
            <div>
                <a rel="nofollow" href="./index.html">首页</a> |
                <a rel="nofollow" target="_blank" href="./index.html">关于贝贝</a> |

                <a rel="nofollow" target="_blank" href="./index.html">商家入驻</a> |
                <a rel="nofollow" target="_blank" href="./ensure.html">正品保证</a> |

                <a rel="nofollow" target="_blank" href="./index.html">人才招聘</a> |

                <a rel="nofollow" target="_blank" href="./callservice.html">联系我们</a> |
                <a rel="nofollow" target="_blank" href="./callservice.html">帮助中心</a> |
                <a rel="nofollow" target="_blank" href="./callservice.html">友情链接</a> |
                <a rel="nofollow" target="_blank" href="./callservice.html">手机客户端</a> |
                <a rel="nofollow" target="_blank" href="./callservice.html">客服在线</a> |

                <a rel="nofollow" target="_blank" href="./index.html">贝贝公益</a> |
                <a rel="nofollow" target="_blank" href="./index.html">品质健康</a> |
                <a rel="nofollow" target="_blank" href="./index.html">育儿社区</a> |
                <a rel="nofollow" target="_blank" href="./index.html">隐私协议</a>
            </div>
        </div>
        <div class="footer-th">
            <p>浙ICP备14025287号 |
                食品流通许可证：SP3301041510054925 |
                出版物经营许可证：新出发零字第00086号 |
                知识产权 |
                浙公网安备 33010402000616号
            </p>
            <p>&copy; 2014-2019 杭州贝购科技有限公司 All Rights Reserved. 客服热线：0571-10107788</p>
        </div>
    </footer>
    <script src="../js/HeaderF.js"></script>
    <script src="../js/jquery-1.11.0.min.js"> </script>
    <script src="../js/cookie.js"></script>
    <script>
        var cart = {
            allChecked: true, //是否全选
            total: 0,

        };
        // 取cookie
        var goods = getCookie("goods") ? JSON.parse(getCookie("goods")) : [];

        cart.items = goods;
        // 根据数据动态生成表格
        var tbody = document.querySelector('tbody');
        // 不可以
        fillCart();

        function fillCart() {
            // 计算 小计
            subTotal()
            var str = "";
            for (var i = 0; i < cart.items.length; i++) {
                str = str + `
        <tr>
           
            <td><img class="active" src="../images/s-smail.jpg" /></td>
            <td>
                <input type="checkbox" ${cart.items[i].isChecked?'checked':''} class="check">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            </td>
            <td>${cart.items[i].goodsName}</td>
            <td class="price">￥${cart.items[i].goodsPrice}</td>
            <td class="count">
                <i class="reduce">-</i>
                <b class="countNum">${cart.items[i].itemNum}</b>
                <i class="add">+</i>
            </td>
            <td class="subTotal">￥${cart.items[i].subTotal}</td>
            <td>
                <a href="javascript:;" class="del">删除</a>
            </td>
     </tr>
        `
            }

            tbody.innerHTML = str;
            // 总价格
            var allCheck = document.querySelectorAll(".allCheck");

            for (var i = 0; i < allCheck.length; i++) {
                allCheck[i].checked = cart.allChecked;

            }
            $(".total_text").html(caltTotal(cart.items));

            // 可以获取
            var add = document.querySelectorAll('.add');
            var reduce = document.querySelectorAll('.reduce');
            for (var i = 0; i < add.length; i++) {
                add[i].index = i;
                add[i].onclick = function () {
                    //alert(1);
                    cart.items[this.index].itemNum = cart.items[this.index].itemNum + 1;
                    fillCart();
                    $(".countNum").eq(this.index).html(cart.items[this.index].itemNum);
                }
            }
            for (var i = 0; i < reduce.length; i++) {
                reduce[i].index = i;
                reduce[i].onclick = function () {
                    //alert(1);
                    cart.items[this.index].itemNum = cart.items[this.index].itemNum - 1;
                    fillCart();
                    $(".countNum").eq(this.index).html(cart.items[this.index].itemNum);
                }
            }
            // 商品选中和取消选中
            // 获取选择框
            var checks = document.querySelectorAll('.check');
            for (var i = 0; i < checks.length; i++) {
                checks[i].index = i;
                checks[i].onchange = function () {
                    // console.log(this.index);
                    // console.log(this.checked);
                    cart.items[this.index].isChecked = this.checked;
                    var {
                        items
                    } = cart;
                    if (items.every(el => el.isChecked)) {
                        cart.allChecked = true;
                    } else {
                        cart.allChecked = false;
                    }
                    /* var res = items.every(function(el){
                        return el.isChecked
                    });
                    if(res){

                    } */
                    fillCart();
                }
            }

            // 全选 取消全选
            var allCheck = document.querySelectorAll(".allCheck");
            for (var i = 0; i < allCheck.length; i++) {
                allCheck[i].onchange = function () {
                    cart.allChecked = this.checked;
                    // 当取消 选中时 所有的商品要取消选择
                    if (!this.checked) {
                        cart.items.forEach(function (el) {
                            el.isChecked = false;
                        });
                    } else {
                        cart.items.map(function (el) {
                            el.isChecked = true;
                        });
                    }
                    fillCart();
                }
            }

            // 删除
            var del = document.querySelectorAll(".del");
            for (var i = 0; i < del.length; i++) {
                del[i].index = i;
                del[i].onclick = function () {
                    var index1 = this.index;
                    if (confirm("您确认删除吗")) {
                        cart.items.splice(this.index, 1);
                        fillCart();
                        setCookie("goods", JSON.stringify(goods), 6);
                    }
                }
            }
        }


        // 计算小计
        function subTotal() {
            for (var i = 0; i < cart.items.length; i++) {
                if (!cart.items[i].itemNum) {
                    cart.items[i].itemNum = 1;
                }
                cart.items[i].subTotal = parseFloat((cart.items[i].goodsPrice * cart.items[i].itemNum).toFixed(2));
            }
        }


        //计算总价格
        function caltTotal(items) {

            var total = 0;

            for (var i = 0; i < items.length; i++) {
                total += items[i].subTotal;
            }

            return total;
        }
    </script>
</body>

</html>